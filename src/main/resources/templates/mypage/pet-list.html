<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>애니플랜트 : 반려친구 리스트</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <style>
    .logo_aniplant .link {
        background-image: url("/img/aniplant_logo01.png");
        background-repeat: no-repeat;
        background-size: 200px 100px;
        background-position: center;
        display: block;
        width: 200px;
        height: 100px;
    }
    .blind {
        position: absolute;
        width: 1px;
        height: 1px;
        overflow: hidden;
        clip: rect(0 0 0 0);
    }
    .error {
        color: red;
        font-size: 12px;
    }
  </style>
 <script>
    function calculateAge(birth) {
      const birthDate = new Date(birth);
      const today = new Date();
      // 나이 기본값을 1로 시작하게 변경
      let age = today.getFullYear() - birthDate.getFullYear() + 1;
      const monthDifference = today.getMonth() - birthDate.getMonth();

      if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < birthDate.getDate())) {
        age--;
      }
      
      return age;
    }
  </script>
</head>
<body>
    <h1 class="logo_aniplant">
        <a href="/index.do" class="link"></a>
        <span class="blind">애니플랜트</span>
    </h1>
    <table>
        <tr>
            <th>이름</th>
            <th>생일</th>
            <th>입양일</th>
            <th>나이</th>
        </tr>
        <tr th:each="pet: ${petList}">
            <td th:text="${pet.name}"></td>
            <!-- '생일' 날짜 서식 적용 -->
            <td th:text="${#dates.format(pet.birth, 'yyyy-MM-dd')}"></td>
            <!-- '입양일' 날짜 서식 적용 -->
            <td th:text="${#dates.format(pet.adopted_at, 'yyyy-MM-dd')}"></td>
            <!-- 나이 출력: JavaScript로 계산한 나이를 출력하기 위한 빈 엘리먼트 -->
            <td class="age" th:data-birth="${#dates.format(pet.birth, 'yyyy-MM-dd')}"></td>
        </tr>
    </table>
    <script>
        // DOM이 완전히 로드된 후에 나이 계산 함수 실행
        document.addEventListener('DOMContentLoaded', function() {
           const ageCells = document.getElementsByClassName('age');
     
           for (let ageCell of ageCells) {
              const birth = ageCell.dataset.birth;
              const age = calculateAge(birth);
              ageCell.innerText = age + "살";
           }
        });
    </script>
</body>
</html>