<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml"
xmlns:th="http://www.thymeleaf.org"
xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
layout:decorate="~{layout/defaultLayout}"><!--푸터, 헤더 적용--> 

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <title>게시글 내용 보기</title>
</head>

<!-- 해당 페이지 고유 CSS 추가 -->
<th:block layout:fragment="css">
  <style>
    .container {
              display: flex;
              flex-direction: row; 
              align-items: start;
          }
          
          
  </style>
      <!--    <link rel="stylesheet" th:href="@{/css/page/home.css}" >-->
</th:block>
<!-- 해당 페이지 고유 스크립트 추가 -->
<th:block layout:fragment="script"> 
   <script th:inline="javascript">
   
   function increaseGoodCount(post_num) {
       $.ajax({
           type: "POST",
           url: "/board/increaseGoodCount",
           data: { post_num: post_num },
           success: function (response) {
               alert(response);
           },
           error: function (error) {
               alert("오류가 발생했습니다.");
           },
       });
   }

   function increaseBadCount(post_num) {
       $.ajax({
           type: "POST",
           url: "/board/increaseBadCount",
           data: { post_num: post_num },
           success: function (response) {
               alert(response);
           },
           error: function (error) {
               alert("오류가 발생했습니다.");
           },
       });
   }
   
   document.addEventListener("DOMContentLoaded", function() {
         var editButton = document.getElementById("editButton");
         var titleInput = document.getElementById("titleInput");
         var contentTextarea = document.getElementById("contentTextarea");
         var deleteButton = document.getElementById("deleteButton"); // 추가
       	 var goodButton = document.getElementById("goodButton");
         var badButton = document.getElementById("badButton");
         
         editButton.addEventListener("click", function() {
          topLevelSelect.removeAttribute("disabled");
           titleInput.removeAttribute("disabled");
           contentTextarea.removeAttribute("disabled");
           editButton.style.display = "none";
           resetButton.style.display = "inline";
           saveButton.style.display = "inline";
           deleteButton.style.display = "none";
           goodButton.style.display = "none";
           badButton.style.display = "none";
         });         
       });
   </script>
   
</th:block>

<body>
  <!-- Content -->
<div layout:fragment="content" class="container">
  <!-- sidebar fragment 사용 -->
  <div th:replace="sidebar/article :: articleSidebar"></div>
  
  <div class="content">
    <h3 >게시글 내용 보기</h3>
    <h4>게시글 정보</h4>
    <h5>게시글번호 : <span th:text="${board.post_num}"></span>
       작성자 : <span th:text="${board.created_user_num}"></span>
       조회수 : <span th:text="${board.views}"></span>
       추천수 : <span th:text="${board.good}"></span>
        비추천수 : <span th:text="${board.bad}"></span>
        작성일 : <span th:text="${board.created_at}"></span>
        수정일 : <span th:text="${board.updated_at}" id="updated_at" ></span></h5>
    
    
    <form id="viewArticle" name="viewArticle" th:action="@{/edit/{post_num}(post_num=${board.post_num})}" th:object="${board}" method="post">
        
        <table align="left">
             <tr>
                  <td align="left">카테고리</td>
                    <td colspan="2" >
                      <select id="topLevelSelect" name="categoryNum" th:field="*{category_num}"disabled>
                        <option  th:value="3">강아지</option>
                        <option  th:value="4">고양이</option>
                        <option th:value="5">화초</option>
                        <option th:value="6">작물</option>
                        <option th:value="7">고객문의</option>
                      </select>
                      
                </td>
            
           
            </tr> 
            <tr>
                <td align="left">제목 </td>
                <td colspan="2" ><input id="titleInput"  type="text" size="50" maxlength="60" th:field="*{title}" disabled/></td>
            </tr>
            <tr>
                <td align="left" valign="top"><br>내용 </td>
                <td colspan="2"><textarea  id="contentTextarea"  name="content" rows="10" cols="65" maxlength="4000" th:field="*{content}" disabled></textarea> </td>
            </tr>
            <tr>
                <td align="left"> </td>
                <td colspan="2"> 
                      <button type="reset" value="초기화" id="resetButton" style="display: none;">초기화</button>
                      <button type="submit" value="저장하기" id="saveButton" style="display: none;" onclick="return confirm('변경내용을 저장하시겠습니까?')">저장하기</button>   
      
                </td>
            </tr>
        </table>
    </form>

			<form th:action="@{delete/{post_num}(post_num=${board.post_num})}"	method="post">
				<button type="button" value="수정하기" id="editButton" th:if="${board.created_user_num == #authentication.principal.usernum}">수정하기</button>

				<!-- 삭제하기 버튼을 특정 조건에 따라 보이게 하기 -->
				<button type="submit" value="삭제하기" id="deleteButton" onclick="return confirm('게시글을 삭제하시겠습니까?')" th:if="${board.created_user_num == #authentication.principal.usernum}">삭제하기</button>

				<input type="hidden" name="categoryNum"	th:value="${board.category_num}" />
			</form>

			<button id="goodButton" th:attr="data-post-num=${board.post_num}" onclick="increaseGoodCount(this.getAttribute('data-post-num'))">추천</button>
		  <button id="badButton" th:attr="data-post-num=${board.post_num}" onclick="increaseBadCount(this.getAttribute('data-post-num'))">비추천</button>    
  </div>
</div>
</body>
</html>
